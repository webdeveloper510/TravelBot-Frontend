{"ast":null,"code":"import _toConsumableArray from\"/home/codenomad/Downloads/material-dashboard-react-main/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _slicedToArray from\"/home/codenomad/Downloads/material-dashboard-react-main/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";/*eslint-disable*/import React,{useEffect,useState,useRef}from\"react\";import PreViewPage from\"./ChatPreViewFirst\";import{API}from\"config/Api\";import axios from\"axios\";import{useNavigate}from\"react-router-dom\";import PsychologyIcon from'@mui/icons-material/Psychology';import logo from\"../../assets/images/logo.png\";import ThumbDownIcon from'@mui/icons-material/ThumbDown';import ThumbUpIcon from'@mui/icons-material/ThumbUp';import Icon from\"@mui/material/Icon\";import Grid from\"@mui/material/Grid\";import MDTypography from\"components/MDTypography\";import TextField from\"@mui/material/TextField\";import MDBox from\"components/MDBox\";import MDButton from\"components/MDButton\";import MDSnackbar from\"components/MDSnackbar\";import svgIcon from\"../../assets/images/base64.online.png\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var ChatBot=function ChatBot(){var accessToken=localStorage.getItem(\"Token\");var _useState=useState([]),_useState2=_slicedToArray(_useState,2),TopicsState=_useState2[0],setTopicsState=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),newAddState=_useState4[0],setnewAddState=_useState4[1];var _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),ChatID=_useState6[0],setChatID=_useState6[1];var _useState7=useState([]),_useState8=_slicedToArray(_useState7,2),questions=_useState8[0],setQuestions=_useState8[1];var _useState9=useState(\"\"),_useState10=_slicedToArray(_useState9,2),currentQuestion=_useState10[0],setCurrentQuestion=_useState10[1];var _useState11=useState(\"\"),_useState12=_slicedToArray(_useState11,2),currentAnswer=_useState12[0],setCurrentAnswer=_useState12[1];var _useState13=useState([]),_useState14=_slicedToArray(_useState13,2),answers=_useState14[0],setAnswers=_useState14[1];var _useState15=useState(null),_useState16=_slicedToArray(_useState15,2),latestAnswerIndex=_useState16[0],setLatestAnswerIndex=_useState16[1];var _useState17=useState([]),_useState18=_slicedToArray(_useState17,2),AnswerID=_useState18[0],setAnswerID=_useState18[1];var _useState19=useState(null),_useState20=_slicedToArray(_useState19,2),CurrentAnswerID=_useState20[0],setCurrentAnswerID=_useState20[1];var _useState21=useState(null),_useState22=_slicedToArray(_useState21,2),NewAnswer=_useState22[0],setNewAnswer=_useState22[1];var _useState23=useState(false),_useState24=_slicedToArray(_useState23,2),showAnswerChange=_useState24[0],setShowAnswerChange=_useState24[1];var _useState25=useState(false),_useState26=_slicedToArray(_useState25,2),AnswerUpdate=_useState26[0],setAnswerUpdate=_useState26[1];var _useState27=useState(false),_useState28=_slicedToArray(_useState27,2),AnswerTime=_useState28[0],setAnswerTime=_useState28[1];var _useState29=useState(false),_useState30=_slicedToArray(_useState29,2),EffectReloadState=_useState30[0],setEffectReloadState=_useState30[1];var chatContainerRef=useRef(null);var _useState31=useState(null),_useState32=_slicedToArray(_useState31,2),UpdatedConstAnsId=_useState32[0],setUpdatedConstAnsId=_useState32[1];var _useState33=useState(null),_useState34=_slicedToArray(_useState33,2),ValueChatGet=_useState34[0],setValueChatGet=_useState34[1];var _useState35=useState(null),_useState36=_slicedToArray(_useState35,2),ChatDate=_useState36[0],setChatDate=_useState36[1];var _useState37=useState(true),_useState38=_slicedToArray(_useState37,2),first_load=_useState38[0],setFirstLoad=_useState38[1];var _useState39=useState(null),_useState40=_slicedToArray(_useState39,2),StateForIndexCheck=_useState40[0],setStateForIndexCheck=_useState40[1];var navigate=useNavigate();var vendorName=localStorage.getItem(\"vendorName\");var _useState41=useState(null),_useState42=_slicedToArray(_useState41,2),firstnameLetter=_useState42[0],setfirstnameLetter=_useState42[1];// Function Callings ---------------------------------------------------------------------------------------------->\n// ******************************** USEEFFECTS ********************************\nuseEffect(function(){axios.get(API.BASE_URL+\"userprofile/\",{headers:{Authorization:\"Bearer \".concat(accessToken)}}).then(function(res){console.log(res);setfirstnameLetter(res.data.firstname[0]);}).catch(function(err){console.log(err);});});useEffect(function(){axios.get(API.BASE_URL+\"topics/\",{headers:{Authorization:\"Bearer \".concat(accessToken)}}).then(function(resp){var index=resp.data.data.length;setStateForIndexCheck(index);setTopicsState(resp.data.data);if(first_load){setChatID(resp.data.data[index-1].id);setFirstLoad(false);}setChatDateForItem(resp.data.data[index-1].created_at__date);setnewAddState(false);setEffectReloadState(false);}).catch(function(error){console.log(error);});},[newAddState,EffectReloadState]);useEffect(function(){if(ChatID===null||ChatID===\"\"){}else{GetChatDetails(ChatID);}},[EffectReloadState,ChatID]);var GetChatDetails=function GetChatDetails(id){axios.get(API.BASE_URL+\"getchat/\"+id+\"/\",{headers:{Authorization:\"Bearer \".concat(accessToken)}}).then(function(res){console.log(res.data.data);setValueChatGet(res.data.data);var chatHistory=res.data.data;var questionArray=chatHistory.map(function(item){return item.questions;});var answerArray=chatHistory.map(function(item){return item.answer;});var answerTIme=chatHistory.map(function(item){return item.time;});var answerID=chatHistory.map(function(item){return item.id;});var TopicName=chatHistory.map(function(item){return item.topic;});console.log(TopicName,\"=======================\");for(var i=0;i<TopicName.length;i++){if(TopicName[i]===\"\"){continue;}else{console.log(TopicName[i],\"=================\");UpdateTopicName(TopicName[i],ChatID);break;}}setEffectReloadState(false);setQuestions(questionArray);setAnswers(answerArray);setAnswerTime(answerTIme);setAnswerID(answerID);}).catch(function(error){console.log(error);});};// // Functions Management ------------------------------------------------------------------------------------->\nvar handleNewChatClick=function handleNewChatClick(){axios.post(API.BASE_URL+\"topics/\",{name:\"Chat\"},{headers:{Authorization:\"Bearer \".concat(accessToken)}}).then(function(response){console.log(response);setChatID(response.data.data.id);setnewAddState(true);}).catch(function(error){console.log(error);});};var UpdateTopicName=function UpdateTopicName(topic_name,id){axios.put(API.BASE_URL+\"update-topics/\"+id+\"/\",{name:topic_name},{headers:{Authorization:\"Bearer \".concat(accessToken)}}).then(function(response){console.log(response);}).catch(function(error){console.log(error);});};var handleInputQuestion=function handleInputQuestion(event){setCurrentQuestion(event.target.value);};var scrollToBottom=function scrollToBottom(){if(chatContainerRef.current){chatContainerRef.current.scrollTop=chatContainerRef.current.scrollHeight;}};var handleQuestionSubmit=function handleQuestionSubmit(){if(currentQuestion.trim()!==\"\"){setQuestions([].concat(_toConsumableArray(questions),[currentQuestion]));setCurrentQuestion(\"\");scrollToBottom();}var formdata=new FormData();formdata.append(\"query\",currentQuestion);if(ChatID===null||ChatID===\"\"){formdata.append(\"topic_id\",'');}else{formdata.append(\"topic_id\",ChatID);}if(vendorName){vendorName=JSON.stringify(vendorName);console.log(vendorName);formdata.append(\"vendor_name\",JSON.parse(vendorName));console.log(JSON.parse(vendorName));}else{formdata.append(\"vendor_name\",'');}axios.post(API.BASE_URL+\"prediction/\",formdata,{headers:{Authorization:\"Bearer \".concat(accessToken),\"Content-Type\":\"application/json\"}}).then(function(response){var AnswerGet=response.data.Answer;var AnswerIDGet=response.data.id;setAnswerID([].concat(_toConsumableArray(AnswerID),[AnswerIDGet]));setCurrentAnswerID(AnswerIDGet);setAnswers([].concat(_toConsumableArray(answers),[AnswerGet]));setCurrentAnswer(AnswerGet);setLatestAnswerIndex(answers.length);var newVendorName=response.data.vendor_name;localStorage.setItem(\"vendorName\",JSON.stringify(newVendorName));setEffectReloadState(true);scrollToBottom();}).catch(function(error){var AnswerGet=error.response.data.Answer;var AnswerIDGet=error.response.data.id;setAnswerID([].concat(_toConsumableArray(AnswerID),[AnswerIDGet]));setCurrentAnswerID(AnswerIDGet);setAnswers([].concat(_toConsumableArray(answers),[AnswerGet]));setCurrentAnswer(AnswerGet);setLatestAnswerIndex(answers.length);scrollToBottom();});};// Enter Function On Submit Question \nvar handleKeyPress=function handleKeyPress(event){if(event.key===\"Enter\"){handleQuestionSubmit();}};// Change Chat-bot Answer\nvar handleChangeInputAnswer=function handleChangeInputAnswer(event){setNewAnswer(event.target.value);};// Handle Answer edit (Suggestions) Open Pop-Up\nvar handleEditAnswer=function handleEditAnswer(id){console.log(id);setUpdatedConstAnsId(id);setShowAnswerChange(true);};// Handle Close (Suggestion Pop-Up)\nvar handleCloseAnswerUpdate=function handleCloseAnswerUpdate(){setShowAnswerChange(false);};// Handle Update the Answer with the Question ID\nvar handleAnswerUpdate=function handleAnswerUpdate(){var formData=new FormData();formData.append(\"suggestion\",NewAnswer);axios.put(API.BASE_URL+\"suggestion/\"+UpdatedConstAnsId+\"/\",formData,{headers:{Authorization:\"Bearer \".concat(accessToken)}}).then(function(res){setAnswerUpdate(true);setShowAnswerChange(false);setEffectReloadState(true);// Assuming setEffectReloadState is defined\n}).catch(function(error){setShowAnswerChange(false);});};// Handle to set the latest Index of the Answer and Question using the Signs\nvar handleSaveAnswer=function handleSaveAnswer(){setLatestAnswerIndex(null);};// SnackBar Handle To close on the Button \nvar closeWarningSB=function closeWarningSB(){setAnswerUpdate(false);};// Functions Management ------------------------------------------------------------------------------------->\nvar setChatDateForItem=function setChatDateForItem(date){setChatDate(date);};var handleLogOut=function handleLogOut(){localStorage.removeItem(\"Token\");localStorage.removeItem(\"vendorName\");navigate(\"/\");window.location.reload();};// ####----------------------------------------------------------------RETURN VALUE Statements ---------------------------------------------------------------->\nreturn/*#__PURE__*/_jsx(\"div\",{className:\"main\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"chat\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"side-contetnt\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"sidebar\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"new-chat-bttn\",children:/*#__PURE__*/_jsx(\"div\",{className:\"bttn-chat\",children:/*#__PURE__*/_jsxs(\"a\",{className:\"flex px-3 \",href:\"#chat\",onClick:handleNewChatClick,children:[/*#__PURE__*/_jsxs(\"svg\",{stroke:\"currentColor\",fill:\"none\",strokeWidth:\"2\",viewBox:\"0 0 24 24\",strokeLinecap:\"round\",strokeLinejoin:\"round\",className:\"icon-sm shrink-0\",height:\"1em\",width:\"1em\",xmlns:\"http://www.w3.org/2000/svg\",children:[/*#__PURE__*/_jsx(\"line\",{x1:\"12\",y1:\"5\",x2:\"12\",y2:\"19\"}),/*#__PURE__*/_jsx(\"line\",{x1:\"5\",y1:\"12\",x2:\"19\",y2:\"12\"})]}),/*#__PURE__*/_jsx(\"span\",{className:\"truncate\",children:\"New Chat\"})]})})}),TopicsState.map(function(index){return/*#__PURE__*/_jsx(\"div\",{className:\"new-chat-bttn\",onClick:function onClick(){setChatID(index.id);setChatDateForItem(index.created_at__date);},style:{background:index.id===ChatID?\"#fff\":\"\"},children:/*#__PURE__*/_jsx(\"div\",{className:\"bttn-chat\",children:/*#__PURE__*/_jsxs(\"a\",{className:\"flex px-3 active\",href:\"#chat\",style:{color:index.id===ChatID?\"#000\":\"\"},children:[/*#__PURE__*/_jsx(\"svg\",{xmlns:\"http://www.w3.org/2000/svg\",width:\"1em\",height:\"1em\",fill:\"none\",stroke:\"currentColor\",strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:\"2\",className:\"icon-sm\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{d:\"M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z\"})}),/*#__PURE__*/_jsxs(\"span\",{className:\"truncate\",children:[index.name,\" \"]})]})})});}),/*#__PURE__*/_jsx(\"button\",{className:\"logout\",onClick:handleLogOut,children:\"Log Out\"})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"content\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"chat-side px-5\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"chat-messages\",ref:chatContainerRef,children:[/*#__PURE__*/_jsxs(\"div\",{className:\"loader-\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"dot\"}),/*#__PURE__*/_jsx(\"div\",{className:\"dot\"}),/*#__PURE__*/_jsx(\"div\",{className:\"dot\"})]}),(ValueChatGet===null||ValueChatGet===void 0?void 0:ValueChatGet.length)>0?/*#__PURE__*/_jsx(_Fragment,{children:questions.length>0?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-center date\",children:/*#__PURE__*/_jsx(\"p\",{children:ChatDate})}),/*#__PURE__*/_jsx(\"div\",{className:\"chat-start\",children:questions.map(function(question,index){return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"display-flex\",children:[/*#__PURE__*/_jsxs(\"svg\",{xmlns:\"http://www.w3.org/2000/svg\",width:\"30\",height:\"30\",viewBox:\"0 0 64 64\",className:\"display-flex self-center mr-2\",children:[/*#__PURE__*/_jsx(\"circle\",{cx:\"32\",cy:\"32\",r:\"30\",fill:\"#365788\"}),/*#__PURE__*/_jsx(\"text\",{x:\"20\",y:\"42\",fill:\"#fff\",fontFamily:\"Arial, sans-serif\",fontSize:\"36\",children:firstnameLetter})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"question-submit\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"question\",children:question}),/*#__PURE__*/_jsx(\"div\",{className:\"text-right\"})]})]}),answers.length>0&&answers[index]!==\"\"?/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"display-flex\",children:[/*#__PURE__*/_jsxs(\"svg\",{className:\"display-flex self-center mr-2\",xmlns:\"http://www.w3.org/2000/svg\",width:\"30\",height:\"30\"// className=\"icon-md\"\n,viewBox:\"0 0 41 41\",style:{padding:\"4px 4px\",background:\"#365788\",borderRadius:\"15px\"},children:[/*#__PURE__*/_jsx(\"text\",{x:\"-9999\",y:\"-9999\",children:\"ChatGPT\"}),/*#__PURE__*/_jsx(\"path\",{fill:\"#fff\",d:\"M37.532 16.87a9.963 9.963 0 00-.856-8.184 10.078 10.078 0 00-10.855-4.835A9.964 9.964 0 0018.306.5a10.079 10.079 0 00-9.614 6.977 9.967 9.967 0 00-6.664 4.834 10.08 10.08 0 001.24 11.817 9.965 9.965 0 00.856 8.185 10.079 10.079 0 0010.855 4.835 9.965 9.965 0 007.516 3.35 10.078 10.078 0 009.617-6.981 9.967 9.967 0 006.663-4.834 10.079 10.079 0 00-1.243-11.813zM22.498 37.886a7.474 7.474 0 01-4.799-1.735c.061-.033.168-.091.237-.134l7.964-4.6a1.294 1.294 0 00.655-1.134V19.054l3.366 1.944a.12.12 0 01.066.092v9.299a7.505 7.505 0 01-7.49 7.496zM6.392 31.006a7.471 7.471 0 01-.894-5.023c.06.036.162.099.237.141l7.964 4.6a1.297 1.297 0 001.308 0l9.724-5.614v3.888a.12.12 0 01-.048.103l-8.051 4.649a7.504 7.504 0 01-10.24-2.744zM4.297 13.62A7.469 7.469 0 018.2 10.333c0 .068-.004.19-.004.274v9.201a1.294 1.294 0 00.654 1.132l9.723 5.614-3.366 1.944a.12.12 0 01-.114.01L7.04 23.856a7.504 7.504 0 01-2.743-10.237zm27.658 6.437l-9.724-5.615 3.367-1.943a.121.121 0 01.113-.01l8.052 4.648a7.498 7.498 0 01-1.158 13.528v-9.476a1.293 1.293 0 00-.65-1.132zm3.35-5.043c-.059-.037-.162-.099-.236-.141l-7.965-4.6a1.298 1.298 0 00-1.308 0l-9.723 5.614v-3.888a.12.12 0 01.048-.103l8.05-4.645a7.497 7.497 0 0111.135 7.763zm-21.063 6.929l-3.367-1.944a.12.12 0 01-.065-.092v-9.299a7.497 7.497 0 0112.293-5.756 6.94 6.94 0 00-.236.134l-7.965 4.6a1.294 1.294 0 00-.654 1.132l-.006 11.225zm1.829-3.943l4.33-2.501 4.332 2.5v5l-4.331 2.5-4.331-2.5V18z\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"user-response\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"answer\",children:answers[index]?answers[index]:\"....\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text-right\",children:/*#__PURE__*/_jsx(\"small\",{children:AnswerTime[index]?AnswerTime[index].split(':').slice(0,2).join(':'):\"\"})})]})]}),latestAnswerIndex===index?/*#__PURE__*/_jsxs(\"div\",{className:\"thumbs-check\",children:[/*#__PURE__*/_jsx(ThumbUpIcon,{color:\"info\",style:{cursor:\"pointer\"},onClick:handleSaveAnswer}),/*#__PURE__*/_jsx(ThumbDownIcon,{color:\"warning\",style:{cursor:\"pointer\"},onClick:function onClick(e){return handleEditAnswer(AnswerID[index]);}})]}):\"\"]},index):/*#__PURE__*/_jsx(_Fragment,{})]},index);})})]}):/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsx(\"div\",{className:\"logo-ct\",children:/*#__PURE__*/_jsx(\"img\",{src:logo,alt:\"chat image\"})})})}):/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsx(\"div\",{className:\"logo-ct\",children:/*#__PURE__*/_jsx(\"img\",{src:logo,alt:\"chat image\"})})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"input-group-container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"input-padd\",children:[/*#__PURE__*/_jsx(\"textarea\",{id:\"another-textarea\",type:\"text\",className:\"form-control-chat\",value:currentQuestion,onChange:handleInputQuestion,onKeyPress:handleKeyPress}),/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-primary\",type:\"submit\",onClick:function onClick(){handleQuestionSubmit();},children:/*#__PURE__*/_jsxs(\"svg\",{id:\"ic_send\",fill:\"#FFFFFF\",height:\"24\",viewBox:\"0 0 24 24\",width:\"24\",xmlns:\"http://www.w3.org/2000/svg\",\"aria-hidden\":\"true\",children:[/*#__PURE__*/_jsx(\"path\",{d:\"M2.01 21L23 12 2.01 3 2 10l15 2-15 2z\"}),/*#__PURE__*/_jsx(\"path\",{d:\"M0 0h24v24H0z\",fill:\"none\"})]})})]}),/*#__PURE__*/_jsx(\"span\",{className:\"text-center text-gray w-100 mt-2 copyright\",children:\"\\xA9 2023 Exclusive Malta, All rights reserved\"})]}),showAnswerChange?/*#__PURE__*/_jsx(\"div\",{className:\"modal\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"modal-content\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"close-div\",children:/*#__PURE__*/_jsx(\"button\",{className:\"close-button\",icon:\"close\",onClick:handleCloseAnswerUpdate,children:/*#__PURE__*/_jsx(Icon,{children:\"close\"})})}),/*#__PURE__*/_jsxs(Grid,{item:true,children:[/*#__PURE__*/_jsx(MDTypography,{variant:\"h6\",fontWeight:\"medium\",textTransform:\"capitalize\",textAlign:\"center\",children:\"Enter Suggestion\"}),/*#__PURE__*/_jsx(MDBox,{pt:4,pb:3,px:3,children:/*#__PURE__*/_jsxs(MDBox,{component:\"form\",role:\"form\",children:[/*#__PURE__*/_jsx(MDBox,{mb:2,children:/*#__PURE__*/_jsx(TextField,{id:\"outlined-multiline-static\",multiline:true,rows:4,fullWidth:true,variant:\"outlined\",value:NewAnswer,onChange:handleChangeInputAnswer})}),/*#__PURE__*/_jsx(MDBox,{mt:4,mb:1,children:/*#__PURE__*/_jsx(MDButton,{variant:\"gradient\",color:\"info\",fullWidth:true,onClick:handleAnswerUpdate,children:\"Click To Enter\"})})]})})]})]})}):/*#__PURE__*/_jsx(_Fragment,{}),/*#__PURE__*/_jsx(MDSnackbar,{color:\"success\",icon:\"check\",title:\"Answer Updated\",content:\"Answer Updated Successfully!\",dateTime:\"Now\",open:AnswerUpdate,onClose:closeWarningSB,close:closeWarningSB,bgWhite:true})]})})]})});};export default ChatBot;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}