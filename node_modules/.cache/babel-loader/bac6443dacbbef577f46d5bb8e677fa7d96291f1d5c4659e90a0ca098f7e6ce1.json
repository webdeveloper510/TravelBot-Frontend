{"ast":null,"code":"import _toConsumableArray from\"/home/codenomad/Downloads/material-dashboard-react-main/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _slicedToArray from\"/home/codenomad/Downloads/material-dashboard-react-main/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";/*eslint-disable*/import React,{useEffect,useState,useRef}from\"react\";import PreViewPage from\"./ChatPreViewFirst\";import{API}from\"config/Api\";import axios from\"axios\";import{useNavigate}from\"react-router-dom\";import logo from\"../../assets/images/logo.png\";import ThumbDownIcon from'@mui/icons-material/ThumbDown';import ThumbUpIcon from'@mui/icons-material/ThumbUp';import Icon from\"@mui/material/Icon\";import Grid from\"@mui/material/Grid\";import MDTypography from\"components/MDTypography\";import TextField from\"@mui/material/TextField\";import MDBox from\"components/MDBox\";import MDButton from\"components/MDButton\";import MDSnackbar from\"components/MDSnackbar\";import svgIcon from\"../../assets/images/logos/7024404.svg\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var ChatBot=function ChatBot(){var accessToken=localStorage.getItem(\"Token\");var _useState=useState([]),_useState2=_slicedToArray(_useState,2),TopicsState=_useState2[0],setTopicsState=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),newAddState=_useState4[0],setnewAddState=_useState4[1];var _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),ChatID=_useState6[0],setChatID=_useState6[1];var _useState7=useState([]),_useState8=_slicedToArray(_useState7,2),questions=_useState8[0],setQuestions=_useState8[1];var _useState9=useState(\"\"),_useState10=_slicedToArray(_useState9,2),currentQuestion=_useState10[0],setCurrentQuestion=_useState10[1];var _useState11=useState(\"\"),_useState12=_slicedToArray(_useState11,2),currentAnswer=_useState12[0],setCurrentAnswer=_useState12[1];var _useState13=useState([]),_useState14=_slicedToArray(_useState13,2),answers=_useState14[0],setAnswers=_useState14[1];var _useState15=useState([]),_useState16=_slicedToArray(_useState15,2),chatHistory=_useState16[0],getChatHistory=_useState16[1];var _useState17=useState(null),_useState18=_slicedToArray(_useState17,2),latestAnswerIndex=_useState18[0],setLatestAnswerIndex=_useState18[1];var _useState19=useState([]),_useState20=_slicedToArray(_useState19,2),AnswerID=_useState20[0],setAnswerID=_useState20[1];var _useState21=useState(null),_useState22=_slicedToArray(_useState21,2),CurrentAnswerID=_useState22[0],setCurrentAnswerID=_useState22[1];var _useState23=useState(null),_useState24=_slicedToArray(_useState23,2),NewAnswer=_useState24[0],setNewAnswer=_useState24[1];var _useState25=useState(false),_useState26=_slicedToArray(_useState25,2),showAnswerChange=_useState26[0],setShowAnswerChange=_useState26[1];var _useState27=useState(false),_useState28=_slicedToArray(_useState27,2),AnswerUpdate=_useState28[0],setAnswerUpdate=_useState28[1];var _useState29=useState(false),_useState30=_slicedToArray(_useState29,2),AnswerTime=_useState30[0],setAnswerTime=_useState30[1];var _useState31=useState(false),_useState32=_slicedToArray(_useState31,2),EffectReloadState=_useState32[0],setEffectReloadState=_useState32[1];var chatContainerRef=useRef(null);var _useState33=useState(null),_useState34=_slicedToArray(_useState33,2),UpdatedConstAnsId=_useState34[0],setUpdatedConstAnsId=_useState34[1];var _useState35=useState(null),_useState36=_slicedToArray(_useState35,2),ValueChatGet=_useState36[0],setValueChatGet=_useState36[1];var _useState37=useState(null),_useState38=_slicedToArray(_useState37,2),ChatDate=_useState38[0],setChatDate=_useState38[1];var _useState39=useState(null),_useState40=_slicedToArray(_useState39,2),ChatTopicName=_useState40[0],setChatTopicName=_useState40[1];var _useState41=useState(false),_useState42=_slicedToArray(_useState41,2),NewUserF=_useState42[0],setNewUserF=_useState42[1];var _useState43=useState(true),_useState44=_slicedToArray(_useState43,2),first_load=_useState44[0],setFirstLoad=_useState44[1];// const [DefaultChatID , setDefaultChatID] = useState(null);\nvar _useState45=useState(null),_useState46=_slicedToArray(_useState45,2),StateForIndexCheck=_useState46[0],setStateForIndexCheck=_useState46[1];var navigate=useNavigate();useEffect(function(){axios.get(API.BASE_URL+\"topics/\",{headers:{Authorization:\"Bearer \".concat(accessToken)}}).then(function(resp){var index=resp.data.data.length;setStateForIndexCheck(index);setTopicsState(resp.data.data);if(first_load){setChatID(resp.data.data[index-1].id);setFirstLoad(false);}setChatDateForItem(resp.data.data[index-1].created_at__date);setnewAddState(false);setEffectReloadState(false);}).catch(function(error){console.log(error);});},[newAddState,EffectReloadState]);// Function Calling ---------------------------------------------------------------->\nvar handleNewChatClick=function handleNewChatClick(){axios.post(API.BASE_URL+\"topics/\",{name:\"Chat\"},{headers:{Authorization:\"Bearer \".concat(accessToken)}}).then(function(response){console.log(response);setChatID(response.data.data.id);setnewAddState(true);}).catch(function(error){console.log(error);});};// --------------------------------------------------------------------------------------------------------------------------------------------------------\n// // Functions Management ------------------------------------------------------------------------------------->\nuseEffect(function(){if(ChatID===null||ChatID===\"\"){}else{GetChatDetails(ChatID);}},[EffectReloadState,ChatID]);var GetChatDetails=function GetChatDetails(id){axios.get(API.BASE_URL+\"getchat/\"+id+\"/\",{headers:{Authorization:\"Bearer \".concat(accessToken)}}).then(function(res){console.log(res.data.data);setValueChatGet(res.data.data);var chatHistory=res.data.data;var questionArray=chatHistory.map(function(item){return item.questions;});var answerArray=chatHistory.map(function(item){return item.answer;});var answerTIme=chatHistory.map(function(item){return item.time;});var answerID=chatHistory.map(function(item){return item.id;});var TopicName=chatHistory.map(function(item){return item.topic;});console.log(TopicName,\"=======================\");for(var i=0;i<TopicName.length;i++){if(TopicName[i]===\"\"){continue;}else{console.log(TopicName[i],\"=================\");UpdateTopicName(TopicName[i],ChatID);break;}}setEffectReloadState(false);setQuestions(questionArray);setAnswers(answerArray);setAnswerTime(answerTIme);setAnswerID(answerID);}).catch(function(error){console.log(error);});};var getSideBArValueUpdated=function getSideBArValueUpdated(){axios.get(API.BASE_URL+\"topics/\",{headers:{Authorization:\"Bearer \".concat(accessToken)}}).then(function(resp){console.log(resp);setTopicsState(resp.data.data);console.log(ChatID);}).catch(function(error){});};var UpdateTopicName=function UpdateTopicName(topic_name,id){axios.put(API.BASE_URL+\"update-topics/\"+id+\"/\",{name:topic_name},{headers:{Authorization:\"Bearer \".concat(accessToken)}}).then(function(response){console.log(response);}).catch(function(error){console.log(error);});};var handleInputQuestion=function handleInputQuestion(event){setCurrentQuestion(event.target.value);};var scrollToBottom=function scrollToBottom(){if(chatContainerRef.current){chatContainerRef.current.scrollTop=chatContainerRef.current.scrollHeight;}};var handleQuestionSubmit=function handleQuestionSubmit(){if(currentQuestion.trim()!==\"\"){setQuestions([].concat(_toConsumableArray(questions),[currentQuestion]));setCurrentQuestion(\"\");scrollToBottom();}var formdata=new FormData();formdata.append(\"query\",currentQuestion);// Assuming currentQuestion is defined\nif(ChatID===null||ChatID===\"\"){formdata.append(\"topic_id\",'');// Assuming currentQuestion is defined\n}else{formdata.append(\"topic_id\",ChatID);// Assuming currentQuestion is defined\n}axios.post(API.BASE_URL+\"prediction/\",formdata,{headers:{Authorization:\"Bearer \".concat(accessToken)// Assuming accessToken is defined\n}}).then(function(response){var AnswerGet=response.data.Answer;// Declare AnswerGet\nvar AnswerIDGet=response.data.id;// Declare AnswerIDGet\nsetAnswerID([].concat(_toConsumableArray(AnswerID),[AnswerIDGet]));setCurrentAnswerID(AnswerIDGet);setAnswers([].concat(_toConsumableArray(answers),[AnswerGet]));// Assuming answers and setAnswers are defined\nsetCurrentAnswer(AnswerGet);setLatestAnswerIndex(answers.length);// Assuming setLatestAnswerIndex is defined\n// if (StateForIndexCheck === 0){\nsetEffectReloadState(true);// Assuming setEffectReloadState is defined\n// }else{\n// setEffectReloadState(false); // Assuming setEffectReloadState is defined\n// }\nscrollToBottom();// Assuming scrollToBottom is defined\n}).catch(function(error){var AnswerGet=error.response.data.Answer;// Declare AnswerGet\nvar AnswerIDGet=error.response.data.id;// Declare AnswerIDGet\nsetAnswerID([].concat(_toConsumableArray(AnswerID),[AnswerIDGet]));setCurrentAnswerID(AnswerIDGet);setAnswers([].concat(_toConsumableArray(answers),[AnswerGet]));// Assuming answers and setAnswers are defined\nsetCurrentAnswer(AnswerGet);setLatestAnswerIndex(answers.length);// Assuming setLatestAnswerIndex is defined\nscrollToBottom();// Assuming scrollToBottom is defined\n});};// Enter Function On Submit Question \nvar handleKeyPress=function handleKeyPress(event){if(event.key===\"Enter\"){handleQuestionSubmit();}};// Change Chat-bot Answer\nvar handleChangeInputAnswer=function handleChangeInputAnswer(event){setNewAnswer(event.target.value);};// Handle Answer edit (Suggestions) Open Pop-Up\nvar handleEditAnswer=function handleEditAnswer(id){console.log(id);setUpdatedConstAnsId(id);setShowAnswerChange(true);};// Handle Close (Suggestion Pop-Up)\nvar handleCloseAnswerUpdate=function handleCloseAnswerUpdate(){setShowAnswerChange(false);};// Handle Update the Answer with the Question ID\nvar handleAnswerUpdate=function handleAnswerUpdate(){var formData=new FormData();formData.append(\"suggestion\",NewAnswer);axios.put(API.BASE_URL+\"suggestion/\"+UpdatedConstAnsId+\"/\",formData,{headers:{Authorization:\"Bearer \".concat(accessToken)}}).then(function(res){setAnswerUpdate(true);setShowAnswerChange(false);setEffectReloadState(true);// Assuming setEffectReloadState is defined\n}).catch(function(error){setShowAnswerChange(false);});};// Handle to set the latest Index of the Answer and Question using the Signs\nvar handleSaveAnswer=function handleSaveAnswer(){setLatestAnswerIndex(null);};// SnackBar Handle To close on the Button \nvar closeWarningSB=function closeWarningSB(){setAnswerUpdate(false);};// Functions Management ------------------------------------------------------------------------------------->\nvar setChatDateForItem=function setChatDateForItem(date){setChatDate(date);};var handleLogOut=function handleLogOut(){localStorage.removeItem(\"Token\");navigate(\"/\");window.location.reload();};return/*#__PURE__*/_jsx(\"div\",{className:\"main\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"chat\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"side-contetnt\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"sidebar\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"new-chat-bttn\",children:/*#__PURE__*/_jsx(\"div\",{className:\"bttn-chat\",children:/*#__PURE__*/_jsxs(\"a\",{className:\"flex px-3 \",href:\"#chat\",onClick:handleNewChatClick,children:[/*#__PURE__*/_jsxs(\"svg\",{stroke:\"currentColor\",fill:\"none\",strokeWidth:\"2\",viewBox:\"0 0 24 24\",strokeLinecap:\"round\",strokeLinejoin:\"round\",className:\"icon-sm shrink-0\",height:\"1em\",width:\"1em\",xmlns:\"http://www.w3.org/2000/svg\",children:[/*#__PURE__*/_jsx(\"line\",{x1:\"12\",y1:\"5\",x2:\"12\",y2:\"19\"}),/*#__PURE__*/_jsx(\"line\",{x1:\"5\",y1:\"12\",x2:\"19\",y2:\"12\"})]}),/*#__PURE__*/_jsx(\"span\",{className:\"truncate\",children:\"New Chat\"})]})})}),TopicsState.map(function(index){return/*#__PURE__*/_jsx(\"div\",{className:\"new-chat-bttn\",onClick:function onClick(){setChatID(index.id);setChatDateForItem(index.created_at__date);},style:{background:index.id===ChatID?\"#fff\":\"\"},children:/*#__PURE__*/_jsx(\"div\",{className:\"bttn-chat\",children:/*#__PURE__*/_jsxs(\"a\",{className:\"flex px-3 active\",href:\"#chat\",style:{color:index.id===ChatID?\"#000\":\"\"},children:[/*#__PURE__*/_jsx(\"svg\",{xmlns:\"http://www.w3.org/2000/svg\",width:\"1em\",height:\"1em\",fill:\"none\",stroke:\"currentColor\",strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:\"2\",className:\"icon-sm\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{d:\"M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z\"})}),/*#__PURE__*/_jsxs(\"span\",{className:\"truncate\",children:[index.name,\" \"]})]})})});}),/*#__PURE__*/_jsx(\"button\",{className:\"logout\",onClick:handleLogOut,children:\"Log Out\"})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"content\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"chat-side px-5\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"chat-messages\",ref:chatContainerRef,children:[/*#__PURE__*/_jsxs(\"div\",{className:\"loader-\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"dot\"}),/*#__PURE__*/_jsx(\"div\",{className:\"dot\"}),/*#__PURE__*/_jsx(\"div\",{className:\"dot\"})]}),(ValueChatGet===null||ValueChatGet===void 0?void 0:ValueChatGet.length)>0?/*#__PURE__*/_jsx(_Fragment,{children:questions.length>0?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-center date\",children:/*#__PURE__*/_jsx(\"p\",{children:ChatDate})}),/*#__PURE__*/_jsx(\"div\",{className:\"chat-start\",children:questions.map(function(question,index){return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"display-flex\",children:[/*#__PURE__*/_jsxs(\"svg\",{xmlns:\"http://www.w3.org/2000/svg\",width:\"30\",height:\"30\",viewBox:\"0 0 64 64\",className:\"display-flex self-center mr-2\",children:[/*#__PURE__*/_jsx(\"circle\",{cx:\"32\",cy:\"32\",r:\"30\",fill:\"#ff5722\"}),/*#__PURE__*/_jsx(\"text\",{x:\"20\",y:\"42\",fill:\"#fff\",fontFamily:\"Arial, sans-serif\",fontSize:\"36\",children:\"T\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"question-submit\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"question\",children:question}),/*#__PURE__*/_jsx(\"div\",{className:\"text-right\"})]})]}),answers.length>0&&answers[index]!==\"\"?/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"display-flex\",children:[/*#__PURE__*/_jsx(\"svg\",{xmlns:\"http://www.w3.org/2000/svg\",width:\"30\",height:\"30\",\"data-name\":\"Layer 1\",viewBox:\"0 0 24 24\",className:\"display-flex self-center mr-2\",children:/*#__PURE__*/_jsx(\"path\",{d:\"M22 11a4 4 0 00-2-3.48A3 3 0 0020 7a3 3 0 00-3-3h-.18A3 3 0 0012 2.78 3 3 0 007.18 4H7a3 3 0 00-3 3 3 3 0 000 .52 4 4 0 00-.55 6.59A4 4 0 007 20h.18A3 3 0 0012 21.22 3 3 0 0016.82 20H17a4 4 0 003.5-5.89A4 4 0 0022 11zM11 8.55a4.72 4.72 0 00-.68-.32 1 1 0 00-.64 1.9A2 2 0 0111 12v1.55a4.72 4.72 0 00-.68-.32 1 1 0 00-.64 1.9A2 2 0 0111 17v2a1 1 0 01-1 1 1 1 0 01-.91-.6 4.07 4.07 0 00.48-.33 1 1 0 10-1.28-1.54A2 2 0 017 18a2 2 0 01-2-2 2 2 0 01.32-1.06A3.82 3.82 0 006 15a1 1 0 000-2 1.84 1.84 0 01-.69-.13A2 2 0 015 9.25a3.1 3.1 0 00.46.35 1 1 0 101-1.74.9.9 0 01-.34-.33A.92.92 0 016 7a1 1 0 011-1 .76.76 0 01.21 0 3.85 3.85 0 00.19.47 1 1 0 001.37.37 1 1 0 00.36-1.34A1.06 1.06 0 019 5a1 1 0 012 0zm7.69 4.32A1.84 1.84 0 0118 13a1 1 0 000 2 3.82 3.82 0 00.68-.06A2 2 0 0119 16a2 2 0 01-2 2 2 2 0 01-1.29-.47 1 1 0 00-1.28 1.54 4.07 4.07 0 00.48.33 1 1 0 01-.91.6 1 1 0 01-1-1v-2a2 2 0 011.32-1.87 1 1 0 00-.64-1.9 4.72 4.72 0 00-.68.32V12a2 2 0 011.32-1.87 1 1 0 00-.64-1.9 4.72 4.72 0 00-.68.32V5a1 1 0 012 0 1.06 1.06 0 01-.13.5 1 1 0 00.36 1.37 1 1 0 001.37-.37 3.85 3.85 0 00.19-.5.76.76 0 01.21 0 1 1 0 011 1 1 1 0 01-.17.55.9.9 0 01-.33.31 1 1 0 001 1.74 2.66 2.66 0 00.5-.35 2 2 0 01-.27 3.62z\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"user-response\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"answer\",children:answers[index]?answers[index]:\"....\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text-right\",children:/*#__PURE__*/_jsx(\"small\",{children:AnswerTime[index]?AnswerTime[index].split(':').slice(0,2).join(':'):\"\"})})]})]}),latestAnswerIndex===index?/*#__PURE__*/_jsxs(\"div\",{className:\"thumbs-check\",children:[/*#__PURE__*/_jsx(ThumbUpIcon,{color:\"info\",style:{cursor:\"pointer\"},onClick:handleSaveAnswer}),/*#__PURE__*/_jsx(ThumbDownIcon,{color:\"warning\",style:{cursor:\"pointer\"},onClick:function onClick(e){return handleEditAnswer(AnswerID[index]);}})]}):\"\"]},index):/*#__PURE__*/_jsx(_Fragment,{})]},index);})})]}):/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsx(\"div\",{className:\"logo-ct\",children:/*#__PURE__*/_jsx(\"img\",{src:logo,alt:\"chat image\"})})})}):/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsx(\"div\",{className:\"logo-ct\",children:/*#__PURE__*/_jsx(\"img\",{src:logo,alt:\"chat image\"})})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"input-group-container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"input-padd\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",className:\"form-control-chat\",value:currentQuestion,onChange:handleInputQuestion,onKeyPress:handleKeyPress}),/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-primary\",type:\"submit\",onClick:function onClick(){handleQuestionSubmit;},children:/*#__PURE__*/_jsxs(\"svg\",{id:\"ic_send\",fill:\"#FFFFFF\",height:\"24\",viewBox:\"0 0 24 24\",width:\"24\",xmlns:\"http://www.w3.org/2000/svg\",\"aria-hidden\":\"true\",children:[/*#__PURE__*/_jsx(\"path\",{d:\"M2.01 21L23 12 2.01 3 2 10l15 2-15 2z\"}),/*#__PURE__*/_jsx(\"path\",{d:\"M0 0h24v24H0z\",fill:\"none\"})]})})]}),/*#__PURE__*/_jsx(\"span\",{className:\"text-center text-gray w-100 mt-2 copyright\",children:\"\\xA9 2023 Exclusive Malta, All rights reserved\"})]}),showAnswerChange?/*#__PURE__*/_jsx(\"div\",{className:\"modal\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"modal-content\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"close-div\",children:/*#__PURE__*/_jsx(\"button\",{className:\"close-button\",icon:\"close\",onClick:handleCloseAnswerUpdate,children:/*#__PURE__*/_jsx(Icon,{children:\"close\"})})}),/*#__PURE__*/_jsxs(Grid,{item:true,children:[/*#__PURE__*/_jsx(MDTypography,{variant:\"h6\",fontWeight:\"medium\",textTransform:\"capitalize\",textAlign:\"center\",children:\"Enter Suggestion\"}),/*#__PURE__*/_jsx(MDBox,{pt:4,pb:3,px:3,children:/*#__PURE__*/_jsxs(MDBox,{component:\"form\",role:\"form\",children:[/*#__PURE__*/_jsx(MDBox,{mb:2,children:/*#__PURE__*/_jsx(TextField,{id:\"outlined-multiline-static\",multiline:true,rows:4,fullWidth:true,variant:\"outlined\",value:NewAnswer,onChange:handleChangeInputAnswer})}),/*#__PURE__*/_jsx(MDBox,{mt:4,mb:1,children:/*#__PURE__*/_jsx(MDButton,{variant:\"gradient\",color:\"info\",fullWidth:true,onClick:handleAnswerUpdate,children:\"Click To Enter\"})})]})})]})]})}):/*#__PURE__*/_jsx(_Fragment,{}),/*#__PURE__*/_jsx(MDSnackbar,{color:\"success\",icon:\"check\",title:\"Answer Updated\",content:\"Answer Updated Successfully!\",dateTime:\"Now\",open:AnswerUpdate,onClose:closeWarningSB,close:closeWarningSB,bgWhite:true})]})})]})});};export default ChatBot;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}